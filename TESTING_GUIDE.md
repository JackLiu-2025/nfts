# NFT Marketplace 测试指南

## 🎯 测试目标

本指南将帮助你完整测试NFT Marketplace的所有功能，包括：
- 钱包连接
- NFT铸造（真实IPFS + 智能合约）
- NFT挂单出售
- NFT购买
- 取消挂单
- NFT销毁

## 📋 准备工作

### 1. 确保服务运行

检查以下服务是否正在运行：

```bash
# 检查Hardhat节点
curl http://localhost:8545

# 检查前端
curl http://localhost:5174
```

如果没有运行，启动它们：

```bash
# 终端1: 启动Hardhat节点
cd contracts
npm run node

# 终端2: 启动前端
cd frontend
npm run dev
```

### 2. 配置MetaMask

#### 添加Hardhat本地网络

1. 打开MetaMask
2. 点击网络下拉菜单 → "添加网络" → "手动添加网络"
3. 填入信息：
   - 网络名称: `Hardhat Local`
   - RPC URL: `http://localhost:8545`
   - Chain ID: `1337`
   - 货币符号: `ETH`
4. 保存

#### 导入测试账户

至少导入2个账户用于测试买卖功能：

**账户 #0** (卖家):
- 地址: `0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266`
- 私钥: `0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80`

**账户 #1** (买家):
- 地址: `0x70997970C51812dc3A010C7d01b50e0d17dc79C8`
- 私钥: `0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d`

导入方法：
1. MetaMask → 账户图标 → "导入账户"
2. 选择"私钥"
3. 粘贴私钥
4. 点击"导入"

### 3. 验证Pinata配置

检查 `frontend/.env` 文件：

```env
VITE_PINATA_API_KEY=your_api_key
VITE_PINATA_SECRET_KEY=your_secret_key
VITE_PINATA_JWT=your_jwt_token
VITE_NETWORK=hardhat
```

确保Pinata配置正确，这样图片会真实上传到IPFS。

## 🧪 测试流程

### 测试 1: 钱包连接

**目标**: 验证钱包连接功能

**步骤**:
1. 打开浏览器访问 http://localhost:5174
2. 点击右上角"连接钱包"按钮
3. MetaMask弹出连接请求
4. 点击"下一步" → "连接"
5. 确保MetaMask选择了"Hardhat Local"网络

**预期结果**:
- ✅ 钱包成功连接
- ✅ 显示账户地址（缩写格式）
- ✅ 显示余额（10000 ETH）
- ✅ 可以复制地址

**验证**:
- 点击地址旁边的复制按钮
- 粘贴到记事本，应该是完整地址

---

### 测试 2: NFT铸造（完整流程）

**目标**: 验证NFT铸造功能（IPFS上传 + 智能合约）

**步骤**:
1. 确保使用账户 #0 连接
2. 点击导航栏"铸造"
3. 准备一张测试图片（JPG/PNG，小于10MB）
4. 点击上传区域，选择图片
5. 填写信息：
   - 名称: `Test NFT #1`
   - 描述: `This is my first test NFT`
   - 分类: 选择 `Art`
   - 版税: `5`
6. 检查右侧预览是否正确
7. 点击"铸造"按钮
8. 观察进度提示：
   - "上传到IPFS..." (约5-10秒)
   - "正在铸造..." (约2-5秒)
9. MetaMask弹出交易确认
10. 点击"确认"
11. 等待交易完成

**预期结果**:
- ✅ 图片成功上传到IPFS
- ✅ 显示"上传到IPFS..."提示
- ✅ 显示"正在铸造..."提示
- ✅ MetaMask弹出交易确认
- ✅ 交易成功
- ✅ 显示"铸造成功！Token ID: X"
- ✅ 自动跳转到个人中心
- ✅ 余额略微减少（Gas费用）

**验证**:
1. 打开浏览器控制台（F12）
2. 查看Network标签，应该看到Pinata API请求
3. 查看Console，应该看到IPFS URL（ipfs://Qm...）
4. 在MetaMask中查看交易历史

**常见问题**:
- 如果上传失败：检查Pinata配置
- 如果交易失败：检查Hardhat节点是否运行
- 如果余额不足：确保使用了测试账户

---

### 测试 3: 查看铸造的NFT

**目标**: 验证NFT数据正确存储

**步骤**:
1. 在个人中心，选择"我创作的"标签
2. 应该看到刚才铸造的NFT
3. 点击NFT卡片进入详情页

**预期结果**:
- ✅ NFT显示正确的图片
- ✅ 显示正确的名称和描述
- ✅ 显示创作者地址（你的地址）
- ✅ 显示拥有者地址（你的地址）
- ✅ 显示版税（5%）
- ✅ 显示分类（Art）
- ✅ 显示"挂单出售"和"销毁"按钮

---

### 测试 4: 挂单出售

**目标**: 验证NFT挂单功能

**步骤**:
1. 在NFT详情页，点击"挂单出售"按钮
2. 输入价格: `0.1` (ETH)
3. 点击"确认挂单"
4. MetaMask弹出交易确认
5. 点击"确认"
6. 等待交易完成

**预期结果**:
- ✅ 显示价格输入框
- ✅ MetaMask弹出交易确认
- ✅ 交易成功
- ✅ 显示"挂单成功"提示
- ✅ 页面刷新，显示"购买"和"取消挂单"按钮
- ✅ 显示价格 0.1 ETH

**验证**:
- 刷新页面，NFT仍然显示为在售状态
- 在市场页面应该能看到这个NFT

---

### 测试 5: 取消挂单

**目标**: 验证取消挂单功能

**步骤**:
1. 在挂单的NFT详情页
2. 点击"取消挂单"按钮
3. 确认操作
4. MetaMask弹出交易确认
5. 点击"确认"
6. 等待交易完成

**预期结果**:
- ✅ 显示确认对话框
- ✅ MetaMask弹出交易确认
- ✅ 交易成功
- ✅ 显示"取消成功"提示
- ✅ 页面刷新，显示"挂单出售"和"销毁"按钮
- ✅ 不再显示价格

---

### 测试 6: 重新挂单（为购买测试准备）

**目标**: 重新挂单NFT供购买测试

**步骤**:
1. 重复测试4的步骤
2. 挂单价格: `0.1` ETH

---

### 测试 7: 购买NFT（切换账户）

**目标**: 验证NFT购买功能

**步骤**:
1. 在MetaMask中切换到账户 #1（买家）
2. 刷新页面，重新连接钱包
3. 进入市场页面
4. 找到刚才挂单的NFT
5. 点击进入详情页
6. 点击"购买"按钮
7. 确认购买信息（价格、Gas费用）
8. MetaMask弹出交易确认
9. 点击"确认"
10. 等待交易完成

**预期结果**:
- ✅ 显示购买确认对话框
- ✅ 显示正确的价格（0.1 ETH）
- ✅ MetaMask弹出交易确认
- ✅ 交易成功
- ✅ 显示"购买成功"提示
- ✅ 买家余额减少（0.1 ETH + Gas费用）
- ✅ NFT拥有者变为买家地址
- ✅ 不再显示"购买"按钮

**验证**:
1. 切换回账户 #0（卖家）
2. 检查余额应该增加（约0.0975 ETH，扣除2.5%手续费和版税）
3. 在个人中心"我创作的"中，NFT拥有者应该是买家地址
4. 切换到账户 #1（买家）
5. 在个人中心"我收藏的"中，应该看到这个NFT

---

### 测试 8: 销毁NFT

**目标**: 验证NFT销毁功能

**步骤**:
1. 确保使用拥有NFT的账户（买家账户 #1）
2. 进入NFT详情页
3. 点击"销毁"按钮
4. 确认销毁操作
5. MetaMask弹出交易确认
6. 点击"确认"
7. 等待交易完成

**预期结果**:
- ✅ 显示销毁确认对话框
- ✅ 警告信息："此操作不可逆"
- ✅ MetaMask弹出交易确认
- ✅ 交易成功
- ✅ 显示"销毁成功"提示
- ✅ 自动跳转到个人中心
- ✅ NFT不再显示在列表中

**验证**:
- 尝试访问该NFT的详情页，应该显示错误或404
- 在市场页面不应该看到这个NFT

---

### 测试 9: 铸造更多NFT

**目标**: 测试多个NFT的管理

**步骤**:
1. 切换回账户 #0
2. 铸造3-5个不同的NFT
3. 使用不同的分类（Art, Collectible, Gaming, Music）
4. 设置不同的版税（0%, 5%, 10%）

**预期结果**:
- ✅ 所有NFT成功铸造
- ✅ 在个人中心正确显示
- ✅ 每个NFT有唯一的Token ID
- ✅ 图片正确显示

---

### 测试 10: 市场筛选和排序

**目标**: 验证市场页面功能

**步骤**:
1. 进入市场页面
2. 测试分类筛选（All, Art, Collectible等）
3. 测试状态筛选（All, For Sale, Not For Sale）
4. 测试排序（Latest, Price: Low to High, Price: High to Low）

**预期结果**:
- ✅ 筛选功能正常工作
- ✅ 排序功能正常工作
- ✅ NFT正确显示

---

## 📊 测试检查清单

完成所有测试后，确认以下功能：

### 钱包功能
- [ ] 连接钱包
- [ ] 断开钱包
- [ ] 显示余额
- [ ] 显示地址
- [ ] 复制地址
- [ ] 账户切换自动更新
- [ ] 网络切换提示

### NFT铸造
- [ ] 图片上传到IPFS
- [ ] 元数据上传到IPFS
- [ ] 合约铸造成功
- [ ] 显示Token ID
- [ ] 显示交易哈希
- [ ] 余额更新
- [ ] 表单验证
- [ ] 错误处理

### NFT交易
- [ ] 挂单出售
- [ ] 取消挂单
- [ ] 购买NFT
- [ ] 价格计算正确
- [ ] 手续费扣除（2.5%）
- [ ] 版税支付
- [ ] 拥有者转移
- [ ] 余额更新

### NFT管理
- [ ] 查看NFT详情
- [ ] 查看创作者信息
- [ ] 查看拥有者信息
- [ ] 查看交易历史
- [ ] 销毁NFT
- [ ] 个人中心显示

### UI/UX
- [ ] 响应式设计
- [ ] 加载状态
- [ ] 错误提示
- [ ] 成功提示
- [ ] 多语言切换
- [ ] 主题切换

## 🐛 常见问题

### 1. MetaMask连接失败
**问题**: 点击连接钱包没反应
**解决**: 
- 检查MetaMask是否已安装
- 刷新页面
- 检查浏览器控制台错误

### 2. 交易失败
**问题**: 交易被拒绝或失败
**解决**:
- 检查Hardhat节点是否运行
- 检查账户余额
- 查看MetaMask错误信息
- 查看浏览器控制台

### 3. IPFS上传失败
**问题**: 图片上传失败
**解决**:
- 检查Pinata配置
- 检查网络连接
- 检查图片大小（<10MB）
- 检查图片格式

### 4. NFT不显示
**问题**: 铸造后NFT不显示
**解决**:
- 刷新页面
- 检查是否在正确的标签页
- 检查合约事件是否触发
- 查看浏览器控制台

### 5. 余额不更新
**问题**: 交易后余额没变化
**解决**:
- 刷新页面
- 断开重连钱包
- 检查交易是否真的成功

## 📝 测试报告模板

完成测试后，可以使用以下模板记录结果：

```
# NFT Marketplace 测试报告

测试日期: YYYY-MM-DD
测试人员: [你的名字]
测试环境: Hardhat Local

## 测试结果

### 钱包功能
- 连接钱包: ✅/❌
- 显示余额: ✅/❌
- 账户切换: ✅/❌

### NFT铸造
- IPFS上传: ✅/❌
- 合约铸造: ✅/❌
- 数据显示: ✅/❌

### NFT交易
- 挂单出售: ✅/❌
- 购买NFT: ✅/❌
- 取消挂单: ✅/❌
- 销毁NFT: ✅/❌

### 发现的问题
1. [问题描述]
2. [问题描述]

### 建议改进
1. [改进建议]
2. [改进建议]
```

## 🎯 下一步

测试完成后，你可以：

1. **部署到测试网** - 获取测试币后部署到Polygon Amoy
2. **开发后端** - 创建API索引和缓存合约数据
3. **添加更多功能** - 搜索、推荐、收藏等
4. **优化性能** - 缓存、懒加载等
5. **准备主网** - 充分测试后部署到Polygon主网

祝测试顺利！🚀
